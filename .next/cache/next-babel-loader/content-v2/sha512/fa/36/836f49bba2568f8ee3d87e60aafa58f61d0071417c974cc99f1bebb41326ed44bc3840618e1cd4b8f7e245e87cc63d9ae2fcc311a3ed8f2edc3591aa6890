{"ast":null,"code":"import { MongoClient } from 'mongodb';\nimport nextConnect from 'next-connect';\nconst {\n  MONGODB_URI\n} = process.env;\n\nif (!MONGODB_URI) {\n  throw new Error('Please enter mongodb uri');\n}\n\nif (!MONGODB_DB) {\n  throw new Error('Please enter mongodb uri');\n}\n\nlet cached = global.mongo;\nif (!cached) cached = global.mongo = {};\nexport async function ConnectToDatabase() {\n  if (cached.conn) return cached.conn;\n\n  if (!cached.promise) {\n    const conn = {};\n    const opts = {\n      useNewUrlParser: true,\n      useUnifiedTopology: true\n    };\n    cached.promise = MongoClient.connect(MONGODB_URI, opts).then(client => {\n      conn.client = client;\n      return client.db(MONGODB_DB);\n    }).then(db => {\n      conn.db = db;\n      cached.conn = conn;\n    });\n  }\n\n  await cached.promise;\n  return cached.conn;\n}","map":{"version":3,"sources":["/home/manthan/Desktop/react-next/util/database.js"],"names":["MongoClient","nextConnect","MONGODB_URI","process","env","Error","MONGODB_DB","cached","global","mongo","ConnectToDatabase","conn","promise","opts","useNewUrlParser","useUnifiedTopology","connect","then","client","db"],"mappings":"AAAA,SAASA,WAAT,QAA4B,SAA5B;AACA,OAAOC,WAAP,MAAwB,cAAxB;AAEA,MAAM;AAACC,EAAAA;AAAD,IAAgBC,OAAO,CAACC,GAA9B;;AAEA,IAAG,CAACF,WAAJ,EAAgB;AACd,QAAM,IAAIG,KAAJ,CACJ,0BADI,CAAN;AAGD;;AACD,IAAG,CAACC,UAAJ,EAAe;AACb,QAAM,IAAID,KAAJ,CACJ,0BADI,CAAN;AAGD;;AAED,IAAIE,MAAM,GAAGC,MAAM,CAACC,KAApB;AACA,IAAI,CAACF,MAAL,EAAaA,MAAM,GAAGC,MAAM,CAACC,KAAP,GAAc,EAAvB;AAEb,OAAO,eAAeC,iBAAf,GAAkC;AACvC,MAAGH,MAAM,CAACI,IAAV,EAAgB,OAAOJ,MAAM,CAACI,IAAd;;AAChB,MAAG,CAACJ,MAAM,CAACK,OAAX,EAAmB;AACjB,UAAMD,IAAI,GAAE,EAAZ;AACA,UAAME,IAAI,GAAE;AACVC,MAAAA,eAAe,EAAE,IADP;AAEVC,MAAAA,kBAAkB,EAAC;AAFT,KAAZ;AAIFR,IAAAA,MAAM,CAACK,OAAP,GAAiBZ,WAAW,CAACgB,OAAZ,CAAoBd,WAApB,EAAgCW,IAAhC,EAChBI,IADgB,CACVC,MAAD,IAAU;AACdP,MAAAA,IAAI,CAACO,MAAL,GAAcA,MAAd;AACA,aAAOA,MAAM,CAACC,EAAP,CAAUb,UAAV,CAAP;AACD,KAJgB,EAKhBW,IALgB,CAKVE,EAAD,IAAQ;AACZR,MAAAA,IAAI,CAACQ,EAAL,GAASA,EAAT;AACAZ,MAAAA,MAAM,CAACI,IAAP,GAAaA,IAAb;AACD,KARgB,CAAjB;AASC;;AACD,QAAMJ,MAAM,CAACK,OAAb;AACA,SAAOL,MAAM,CAACI,IAAd;AACD","sourcesContent":["import { MongoClient } from 'mongodb';\nimport nextConnect from 'next-connect';\n\nconst {MONGODB_URI} = process.env\n\nif(!MONGODB_URI){\n  throw new Error(\n    'Please enter mongodb uri'\n  )\n}\nif(!MONGODB_DB){\n  throw new Error(\n    'Please enter mongodb uri'\n  )\n}\n\nlet cached = global.mongo\nif (!cached) cached = global.mongo ={}\n\nexport async function ConnectToDatabase(){\n  if(cached.conn) return cached.conn\n  if(!cached.promise){\n    const conn ={}\n    const opts ={\n      useNewUrlParser: true,\n      useUnifiedTopology:true\n    }\n  cached.promise = MongoClient.connect(MONGODB_URI,opts)\n  .then((client)=>{\n    conn.client = client\n    return client.db(MONGODB_DB)\n  })\n  .then((db) => { \n    conn.db =db\n    cached.conn =conn\n  })\n  }\n  await cached.promise\n  return cached.conn\n}"]},"metadata":{},"sourceType":"module"}